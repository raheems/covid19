
# World {#world}

## Confirmed Cases 

```{r, echo=FALSE, message=FALSE, cache=FALSE}
source("covid19_confirmed.R")
```

__Report last updated:__ `r Sys.Date()`

__Data last refreshed:__ : `r data_last_refreshed`


```{r, fig.width=8, fig.height=6, echo = FALSE, warning=FALSE}
# Cumulative Cases since first identified case

p <- ggplot(case_summary, aes(x = Day, y = cum_cases, color=country)) +
  geom_line(size=1.1) +
  geom_point(data = case_summary[case_summary$country == 'Bangladesh' & ymd(case_summary$Date)==data_last_refreshed, ],
             aes(x=Day, y=cum_cases), color='red', size=5) +
  geom_text_repel(size=5, aes(label=country),
                  function(case_summary) case_summary[ymd(case_summary$Date) == data_last_refreshed, ])+
  theme_minimal(base_size = 14) +
  theme(legend.position = "none") +
  # theme_void() +
  theme(legend.position="none") +
  ggtitle("COVID19 cumulative cases since first case \n(top 5 countries excluding China)", data_last_refreshed ) +
  xlab("Days since first confirmed case") +
  ylab("Cumulative cases")

p + scale_y_continuous(labels = function(x) format(x, scientific = FALSE))



```


```{r, echo=FALSE}

# Summary of cases till date by country
world_summary <- df %>%
  filter(ymd(Date) == data_last_refreshed) %>%
  group_by(country) %>%
  summarise(
    Confirmed = max(cum_cases)
  ) %>%
  top_n(10, Confirmed) %>%
  arrange(desc(Confirmed))

confirmed_bd <- df_bd %>%
  filter(ymd(Date) == data_last_refreshed) %>%
  group_by(country) %>%
  summarise(
    Confirmed = max(cum_cases)
  ) %>%
  arrange(desc(Confirmed))

# Confirmed (world + Bangladesh)

world_plus_bd <- rbind(world_summary, confirmed_bd)

world_plus_bd %>%
  kable(format = "html", caption=paste("Top 10 countries by confirmed cases as of", data_last_refreshed)) %>%
  kable_styling(position = "center")


```


## Deaths

```{r, echo=FALSE, message=FALSE, cache=FALSE}
source("covid19_deaths.R")
```


```{r, fig.width=8, fig.height=6, echo = FALSE, warning=FALSE}
# Cumulative Cases since first identified case

p2 <- ggplot(case_summary, aes(x = Day, y = cum_cases, color=country)) +
  geom_line(size=1.1) +
  geom_point(data = case_summary[case_summary$country == 'Bangladesh' & ymd(case_summary$Date)==data_last_refreshed, ],
             aes(x=Day, y=cum_cases), color='red', size=5) +
  geom_text_repel(size=5, aes(label=country),
                  function(case_summary) case_summary[ymd(case_summary$Date) == data_last_refreshed, ])+
  theme_minimal(base_size = 14) +
  theme(legend.position = "none") +
  # theme_void() +
  theme(legend.position="none") +
  ggtitle("COVID19 cumulative deaths since first death \n(top 5 countries excluding China)", data_last_refreshed ) +
  xlab("Days since first death") +
  ylab("Cumulative deaths")

p2 + scale_y_continuous(labels = function(x) format(x, scientific = FALSE))

# 
# 
# plotly::ggplotly(p)

```

```{r, echo=FALSE}

# Summary of deaths till date by country
world_summary <- df %>%
  filter(ymd(Date) == data_last_refreshed) %>%
  group_by(country) %>%
  summarise(
    Deaths = max(cum_cases)
  ) %>%
  top_n(10, Deaths) %>%
  arrange(desc(Deaths))


confirmed_bd <- df_bd %>%
  filter(ymd(Date) == data_last_refreshed) %>%
  group_by(country) %>%
  summarise(
    Deaths = max(cum_cases)
  ) %>%
  arrange(desc(Deaths))

# Confirmed (world + Bangladesh)
world_plus_bd <- rbind(world_summary, confirmed_bd)

world_plus_bd %>%
  kable(format = "html", caption=paste("Top 10 countries by total deathsas of", data_last_refreshed)) %>%
  kable_styling(position = "center")

```

## 3-day % changes for top 6 countries {#perc-change-top6}

The percent change is calculated as 

$$
PC = \frac{New - Original}{Original} * 100
$$
where `New` is the number of cases on a given date, and `Original` is the number 3 days prior to that. 

__How to interpret__: The 3-day percent change tells how much does a metric have changed (%) compared to what it was 3-days ago. A downward tending line suggests a slow growth. When it goes below zero, we can say that the situation is improving.

```{r, echo=FALSE, message=FALSE, cache=FALSE}
source("global_incidence_deaths.R")
```

```{r, fig.width=8, fig.height=9, echo = FALSE, warning=FALSE}

# Global top 6 countries by deaths --------------

# Top 6 countries by deaths
global_top_deaths <- global %>%
  filter(!country %in% c('China')) %>%
  group_by(country) %>%
  summarise(
    max_n_cases = max(cum_deaths)
  ) %>%
  arrange(desc(max_n_cases)) %>%
  top_n(6, max_n_cases)

p <- global_gr_lagx(global, global_top_deaths$country, 3)
p <- p + theme(legend.position="none") +
  ggtitle("COVID19 3-day % change in select metrics \n(Top 6 countries by death, excluding China)", data_last_refreshed ) +
  xlab("Days since first death") +
  ylab("% change") +
  theme(legend.position="bottom") +
  labs(caption = "SOURCE: Johns Hopkins Coronavirus Resource Center")

p + scale_color_discrete(name="Metric",
                         breaks=c("case_gr_rate", "death_gr_rate"),
                         labels=c("New cases", "Deaths")) +
  guides(fill=guides(colour=guide_legend(ncol=2,nrow=1,byrow=TRUE))) +
  facet_wrap( ~ country, ncol = 2) +
  ylim(0, 300)

```
