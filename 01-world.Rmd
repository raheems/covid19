
# World {#world}

## Confirmed Cases 

```{r, echo=FALSE, message=FALSE, cache=FALSE}
source("covid19_confirmed.R")
```

__Report last updated:__ `r Sys.Date()`

__Data last refreshed:__ : `r data_last_refreshed`


```{r, fig.width=8, fig.height=6, echo = FALSE, warning=FALSE}
# Cumulative Cases since first identified case

p <- ggplot(case_summary, aes(x = Day, y = cum_cases, color=country)) +
  geom_line(size=1.1) +
  geom_point(data = case_summary[case_summary$country == 'Bangladesh' & ymd(case_summary$Date)==data_last_refreshed, ],
             aes(x=Day, y=cum_cases), color='red', size=5) +
  geom_text_repel(size=5, aes(label=country),
                  function(case_summary) case_summary[ymd(case_summary$Date) == data_last_refreshed, ])+
  theme_minimal(base_size = 14) +
  theme(legend.position = "none") +
  # theme_void() +
  theme(legend.position="none") +
  ggtitle("COVID19 cumulative cases since first case \n(top 5 countries excluding China)", data_last_refreshed ) +
  xlab("Days since first confirmed case") +
  ylab("Cumulative cases")+
  labs(caption = "SOURCE: Johns Hopkins Coronavirus Resource Center.")

p + scale_y_continuous(labels = function(x) format(x, scientific = FALSE))



```


```{r, echo=FALSE}

# Summary of cases till date by country
world_summary <- df %>%
  filter(ymd(Date) == data_last_refreshed) %>%
  group_by(country) %>%
  summarise(
    Confirmed = max(cum_cases)
  ) %>%
  top_n(10, Confirmed) %>%
  arrange(desc(Confirmed))

confirmed_bd <- df_bd %>%
  filter(ymd(Date) == data_last_refreshed) %>%
  group_by(country) %>%
  summarise(
    Confirmed = max(cum_cases)
  ) %>%
  arrange(desc(Confirmed))

# Confirmed (world + Bangladesh)

world_plus_bd <- rbind(world_summary, confirmed_bd)

world_plus_bd %>%
  kable(format = "html", caption=paste("Top 10 countries by confirmed cases as of", data_last_refreshed)) %>%
  kable_styling(position = "center")


```


## Deaths

```{r, echo=FALSE, message=FALSE, cache=FALSE}
source("covid19_deaths.R")
```


```{r, fig.width=8, fig.height=6, echo = FALSE, warning=FALSE}
# Cumulative Cases since first identified case

p2 <- ggplot(case_summary, aes(x = Day, y = cum_cases, color=country)) +
  geom_line(size=1.1) +
  geom_point(data = case_summary[case_summary$country == 'Bangladesh' & ymd(case_summary$Date)==data_last_refreshed, ],
             aes(x=Day, y=cum_cases), color='red', size=5) +
  geom_text_repel(size=5, aes(label=country),
                  function(case_summary) case_summary[ymd(case_summary$Date) == data_last_refreshed, ])+
  theme_minimal(base_size = 14) +
  theme(legend.position = "none") +
  # theme_void() +
  theme(legend.position="none") +
  ggtitle("COVID19 cumulative deaths since first death \n(top 5 countries excluding China)", data_last_refreshed ) +
  xlab("Days since first death") +
  ylab("Cumulative deaths") +
  labs(caption = "SOURCE: Johns Hopkins Coronavirus Resource Center.")

p2 + scale_y_continuous(labels = function(x) format(x, scientific = FALSE))

# 
# 
# plotly::ggplotly(p)

```

```{r, echo=FALSE}

# Summary of deaths till date by country
world_summary <- df %>%
  filter(ymd(Date) == data_last_refreshed) %>%
  group_by(country) %>%
  summarise(
    Deaths = max(cum_cases)
  ) %>%
  top_n(10, Deaths) %>%
  arrange(desc(Deaths))


confirmed_bd <- df_bd %>%
  filter(ymd(Date) == data_last_refreshed) %>%
  group_by(country) %>%
  summarise(
    Deaths = max(cum_cases)
  ) %>%
  arrange(desc(Deaths))

# Confirmed (world + Bangladesh)
world_plus_bd <- rbind(world_summary, confirmed_bd)

world_plus_bd %>%
  kable(format = "html", caption=paste("Top 10 countries by total deathsas of", data_last_refreshed)) %>%
  kable_styling(position = "center")

```


## Recovery-to-death ratio {#recovery-death-ratio}


The recovery to deaths ratio (RDR) is calculated as

$$
RDR = \frac{\# Cumulative \,\, daily \,\, recovered}{\# Cumulative \,\, daily \,\, deaths}
$$


__How to interpret__: The ratio of cumulative number of patients recovered divided by the cumulative number of deaths over time can tell the proportion of people recovering compared to dying. An upward trend may indicate more recovery than deaths. 


```{r, echo=FALSE, message=FALSE, cache=FALSE}
source("global_recovery_death_ratio.R")
```

```{r, recovery-to-death-ratio-by-country, fig.width=8, fig.height=6, echo = FALSE, warning=FALSE}

# Global top 5 countries by deaths --------------

# Top n countries
n_world <- df %>%
  filter(country != 'China') %>%
  group_by(country) %>%
  summarise(
    deaths = max(cum_deaths)
    , recovered = max(cum_recov)
  ) %>%
  arrange(country) %>%
  top_n(5, deaths)

# Combined n countries
n <- n_world

global <- df %>%
  filter(is.finite(cum_recov_death_ratio)) %>%
  filter(country %in% n$country, cum_recov_death_ratio >= 0) %>%
  arrange(country, date, cum_recov_death_ratio) %>%
  group_by(country) %>%
  mutate(
    day = row_number()
  )
   p <- ggplot(global, aes(x = day, y = cum_recov_death_ratio, color=country)) +
      geom_point(size=1) + geom_smooth() +
     geom_text_repel(size=5, aes(label=country),
                     function(global) global[ymd(global$date) == data_last_refreshed, ])+
     theme_minimal(base_size = 14)

  p <-  p + ggtitle("Recovery-to-death ratio \n(Top 5 countries by death, excluding China)", data_last_refreshed ) +
      xlab("Days since first death") +
      ylab("Cumulative recovery / cumulative deaths") +
      theme(legend.position="top") +
      labs(caption = "SOURCE: Johns Hopkins Coronavirus Resource Center") +
      scale_color_discrete(name="Country")
  
suppressMessages(print(p))


```

### Recovery-to-death ratio (including China)


```{r, recovery-to-death-ratio-by-country-china, fig.width=8, fig.height=6, echo = FALSE, warning=FALSE}


# Top n countries
n_world <- df %>%
  group_by(country) %>%
  summarise(
    deaths = max(cum_deaths)
    , recovered = max(cum_recov)
  ) %>%
  arrange(country) %>%
  top_n(5, deaths)

# Combined n countries
n <- n_world

global <- df %>%
  filter(is.finite(cum_recov_death_ratio)) %>%
  filter(country %in% n$country, cum_recov_death_ratio >= 0) %>%
  arrange(country, date, cum_recov_death_ratio) %>%
  group_by(country) %>%
  mutate(
    day = row_number()
  )
p <- ggplot(global, aes(x = day, y = cum_recov_death_ratio, color=country)) +
  geom_point(size=1) + geom_smooth() +
  geom_text_repel(size=5, aes(label=country),
                  function(global) global[ymd(global$date) == data_last_refreshed, ])+
  theme_minimal(base_size = 14)

p <-  p + ggtitle("Recovery-to-death ratio \n(Top 5 countries by death)", data_last_refreshed ) +
  xlab("Days since first death") +
  ylab("Cumulative recovery / cumulative deaths") +
  theme(legend.position="top") +
  labs(caption = "SOURCE: Johns Hopkins Coronavirus Resource Center") +
  scale_color_discrete(name="Country")

suppressMessages(print(p))



```


### Recovery-to-death ratio (South Asia)


```{r, recovery-to-death-ratio-south-asia, fig.width=8, fig.height=6, echo = FALSE, warning=FALSE}

country_list = c("Bangladesh", "India", "Singapore", "Nepal", "Pakistan",
                   "Bhutan", "Sri Lanka", "Malaysia", "Maldives", 
                   "Indonesia", "Thailand")

# Top n countries
n_world <- df %>%
  filter(country %in% country_list) %>%
  group_by(country) %>%
  summarise(
    deaths = max(cum_deaths)
    , recovered = max(cum_recov)
  ) %>%
  arrange(country) %>%
  top_n(10, deaths)

# Combined n countries
n <- n_world

global <- df %>%
  filter(country %in% country_list) %>%
  filter(is.finite(cum_recov_death_ratio)) %>%
  filter(country %in% n$country, cum_recov_death_ratio >= 0) %>%
  arrange(country, date, cum_recov_death_ratio) %>%
  group_by(country) %>%
  mutate(
    day = row_number()
  )

# plot
p <- ggplot(global, aes(x = day, y = cum_recov_death_ratio, color=country)) +
  geom_point(size=1) + geom_smooth() +
  geom_text_repel(size=5, aes(label=country),
                  function(global) global[ymd(global$date) == data_last_refreshed, ])+
  theme_minimal(base_size = 14)

p <-  p + ggtitle("Recovery-to-death ratio \n(South Asian countries)", data_last_refreshed ) +
  xlab("Days since first death") +
  ylab("Cumulative recovery / cumulative deaths") +
  theme(legend.position="top") +
  labs(caption = "SOURCE: Johns Hopkins Coronavirus Resource Center") +
  scale_color_discrete(name="Country")

suppressMessages(print(p))

```

### Recovery-to-death ratio (Middle East)


```{r, recovery-to-death-ratio-middle-east, fig.width=8, fig.height=6, echo = FALSE, warning=FALSE}

country_list = c("Saudi Arabia", "Iraq", "Iran", "Israel",  "United Arab Emirates")

# Top n countries
n_world <- df %>%
  filter(country %in% country_list) %>%
  group_by(country) %>%
  summarise(
    deaths = max(cum_deaths)
    , recovered = max(cum_recov)
  ) %>%
  arrange(country) %>%
  top_n(10, deaths)

# Combined n countries
n <- n_world

global <- df %>%
  filter(country %in% country_list) %>%
  filter(is.finite(cum_recov_death_ratio)) %>%
  filter(country %in% n$country, cum_recov_death_ratio >= 0) %>%
  arrange(country, date, cum_recov_death_ratio) %>%
  group_by(country) %>%
  mutate(
    day = row_number()
  )

# plot
p <- ggplot(global, aes(x = day, y = cum_recov_death_ratio, color=country)) +
  geom_point(size=1) + geom_smooth() +
  geom_text_repel(size=5, aes(label=country),
                  function(global) global[ymd(global$date) == data_last_refreshed, ])+
  theme_minimal(base_size = 14)

p <-  p + ggtitle("Recovery-to-death ratio \n(Middle Eastern countries)", data_last_refreshed ) +
  xlab("Days since first death") +
  ylab("Cumulative recovery / cumulative deaths") +
  theme(legend.position="top") +
  labs(caption = "SOURCE: Johns Hopkins Coronavirus Resource Center") +
  scale_color_discrete(name="Country")

suppressMessages(print(p))

```


## 3-day % changes {#perc-change-top6}


```{r, echo=FALSE, message=FALSE, cache=FALSE}
source("global_incidence_deaths.R")
```

```{r, fig.width=8, fig.height=9, echo = FALSE, warning=FALSE}

# Global top 6 countries by deaths --------------

# Top 6 countries by deaths
global_top_deaths <- global %>%
  filter(!country %in% c('China')) %>%
  group_by(country) %>%
  summarise(
    max_n_cases = max(cum_deaths)
  ) %>%
  arrange(desc(max_n_cases)) %>%
  top_n(6, max_n_cases)

p <- global_gr_lagx(global, global_top_deaths$country, 3)
p <- p + theme(legend.position="none") +
  ggtitle("COVID19 3-day % change in select metrics \n(Top 6 countries by death, excluding China)", data_last_refreshed ) +
  xlab("Days since first death") +
  ylab("% change") +
  theme(legend.position="bottom") +
  labs(caption = "SOURCE: Johns Hopkins Coronavirus Resource Center")

p + scale_color_discrete(name="Metric",
                         breaks=c("case_gr_rate", "death_gr_rate"),
                         labels=c("New cases", "Deaths")) +
  guides(fill=guides(colour=guide_legend(ncol=2,nrow=1,byrow=TRUE))) +
  facet_wrap( ~ country, ncol = 2) +
  ylim(0, 300)

```


The percent change is calculated as 

$$
PC = \frac{New - Original}{Original} * 100
$$
where `New` is the number of cases on a given date, and `Original` is the number 3 days prior to that. 

__How to interpret__: The 3-day percent change tells how much does a metric have changed (%) compared to what it was 3-days ago. A downward trending line suggests a slow growth.

